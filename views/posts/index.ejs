<% layout("layouts/boilerplate") -%>
<h2 class="my-5">
  <!-- Button trigger modal -->
  <% if(currentUser){ %>
    <button type="button" class="btn btn-primary btn-lg mr-2" id="new-post-form-trigger" data-toggle="modal" data-target="#exampleModal">
      New Post
    </button>
  <% } else { %>
    <a href="/login" class="btn btn-primary btn-lg mr-2">New Post</a>
  <% } %>
  Index Page<span id="page-number"></span>
</h2>
<% if(currentUser){ %>
  <% include ./new.ejs %>
<% } %>
<div class="row mb-3">
  <div class="col-md-12 col-lg-4 mb-4 mb-lg-0">
    <% include ../partials/searchFilter.ejs %>
  </div>
  <div class="col-md-12 col-lg-8">
    <div class="rounded" id="map"></div>
  </div>
</div>
<section class="row mt-5" id="post-container">
<% posts.docs.forEach((post,i)=>{ %>
<div class="col-xs-12 col-sm-12 col-md-6 col-lg-4 mb-5">
  <div class="card">
    <img src="<%= post.images.length ? post.images[0].url : '/images/default_board_img.jpeg' %>" class="card-img-top" alt="..." height="300px">
    <div class="card-body">
      <h5 class="card-title"><%= post.title %></h5>
      <h6 class="card-subtitle mb-3">Price: $<%= post.price %></h6>
      <h6 class="card-subtitle mb-3 text-muted"><%= post.location %></h6>
      <p class="card-text"><%= post.description.slice(0, 20) %> ... </p>
      <a href="/posts/<%= post.id %>" class="card-link">View More</a>
    </div>
  </div>
</div>

<% }) %> 
</section>
<% include ../partials/postPagination %>


<script>
  mapboxgl.accessToken = "<%= mapBoxToken %>";
  var posts = {features: <%- JSON.stringify(posts.docs) %>};
</script>
<script src="/javascripts/allPostsClusterMap.js"></script>
