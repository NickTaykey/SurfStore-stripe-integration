<% layout("layouts/boilerplate") -%>
<h1 class="my-5">
  <a class="btn btn-primary btn-lg mr-2" href="/posts/new">New Post</a>
  Index Page!
</h1>
<div class="row mb-3">
  <div class="col-md-12 col-lg-4 mb-4 mb-lg-0">
    <% include ../partials/searchFilter.ejs %>
  </div>
  <div class="col-md-12 col-lg-8">
    <div id="map"></div>
  </div>
</div>
<section class="row mt-5">
<% posts.docs.forEach((post,i)=>{ %>
<div class="col-xs-12 col-sm-12 col-md-6 col-lg-4 mb-5">
  <div class="card">
    <img src="<%= post.images.length ? post.images[0].url : '/images/default_board_img.jpeg' %>" class="card-img-top" alt="..." height="300px">
    <div class="card-body">
      <h5 class="card-title"><%= post.title %></h5>
      <h6 class="card-subtitle mb-3">Price: $<%= post.price %></h6>
      <h6 class="card-subtitle mb-3 text-muted"><%= post.location %></h6>
      <p class="card-text"><%= post.description.slice(0, 20) %> ... </p>
      <a href="/posts/<%= post.id %>" class="card-link">View More</a>
      <small class="text-muted float-right">Posted <%= moment(new Date(post._id.getTimestamp())).calendar() %></small>
    </div>
  </div>
</div>

<% }) %> 
</section>
<% include ../partials/postPagination %>

<script>
  mapboxgl.accessToken = "<%= mapBoxToken %>";
  var posts = {features: <%- JSON.stringify(posts.docs) %>};
</script>
<script src="/javascripts/allPostsClusterMap.js"></script>
