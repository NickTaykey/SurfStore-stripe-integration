<% layout("layouts/boilerplate") -%>
<header class="mt-5 row">
    <div id="custom-img-container" class="col-xs-12 col-lg-6"  style='<%= currentUser.image.secure_url ? "display: block!important;" : "display: none!important;" %>'>
      <img src="<%= currentUser.image.secure_url %>" alt="<%= currentUser.username %>'s profile image" class="w-100 rounded d-inline-block mr-4"/>
    </div>
    <div 
      id="default-img-container"
      class="col-12  <%= !(currentUser.image.secure_url) ? 'd-block' : 'd-none' %>"
      style='<%= !(currentUser.image.secure_url) ? "display: block!important;" : "display: none!important;" %>'  
    >
      <div class="my-4 text-center">
        <i class="fas fa-user"></i>
      </div>
    </div>
  <div 
    id="title-container"
    class="<%= !currentUser.image.secure_url ? 'col-12' : 'col-xs-12 col-lg-6' %> d-flex align-items-center justify-content-center">
    <h1 
      id="title" 
      class="display-4 text-center <%= currentUser.image.secure_url ? 'my-5' : 'my-3' %>"
    >
      <%= currentUser.username %>'s profile
    </h1>
  </div>
</header>
<section class="<%= currentUser.image.secure_url ? 'my-0 my-lg-5' : 'my-4' %> row">
  <% if(posts && posts.length){ %>
    <div class="col-xs-12 mb-5 col-lg-4">
      <h4 class="mb-4">Recent posts:</h4>
      <ul class="list-group">
        <% posts.forEach(function(post){ %>
          <li class="list-group-item"><a href="/posts/<%= post.id %>"><%= post.title %></a></li>
        <% }) %>
      </ul>
    </div>
  <% } %>
  <div class="col-xs-12 mb-5 <%= posts && posts.length ? 'col-lg-8' : 'd-flex flex-column align-items-center w-100' %>">
    <h4 class="mb-4" id="form-title">Update Info:</h4>
    <h5 class="my-4 d-none" id="upload-image-spinner">
      <div class="d-inline-block  mr-3">
        <div class="spinner-border" role="status">
          <span class="sr-only">Loading...</span>
        </div>
      </div>      
      <span>Uploading Images ... </span>
    </h5>
    <form action="/profile?_method=PUT" method="POST" enctype="multipart/form-data" id="update-profile-form">
      <div class="form-group">
        <label class="d-inline-block" for="username">Username:</label>
        <input
          class="form-control d-inline-block"
          type="text"
          id="username"
          name="username"
          placeholder="username"
          value="<%= currentUser.username %>"
          autofocus
        />
      </div>
      <div class="form-group">
        <label for="current-password"><strong>Current password (required to Update any field): </strong></label>
        <input
          type="password"
          class="form-control d-inline-block"
          id="current-password"
          name="currentPassword"
          placeholder="current password"
        />
      </div>
    
      <div class="form-group">
        <label class="d-inline-block" for="new-password">New Password:</label>
        <input
          class="form-control d-inline-block"
          type="password"
          id="new-password"
          name="newPassword"
          placeholder="new password"
        />
      </div>
      <div class="form-group">
        <label class="d-inline-block" for="password-confirmation">New Password Confermation:</label>
        <input
          class="form-control d-inline-block"
          type="password"
          id="password-confirmation"
          name="passwordConfirmation"
          placeholder="password confirmation"
        />
      </div>
      <div class="form-group validation-message"></div>
    
      <div class="form-group">
        <label class="d-inline-block" for="email">Email:</label>
        <input
          class="form-control d-inline-block"
          type="email"
          name="email"
          id="email"
          placeholder="email"
          value="<%= currentUser.email %>"
        />
      </div>
      <div class="form-group">
        <label class="d-inline-block" for="image">Image:</label>
        <strong>(The current image will be deleted)</strong>
        <input class="form-control" type="file" id="image" name="image" accept="image/*" />
      </div>
      <input class="btn btn-primary btn-block" type="submit" id="update-profile" value="Update" />
    </form>
  </div>
</section>
